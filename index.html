<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos - Super Negrelli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass-effect {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(20, 184, 166, 0.2);
            transition: all 0.3s ease;
        }
        .glass-effect:hover {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(20, 184, 166, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(20, 184, 166, 0.1);
        }
        .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
            border-color: rgba(34, 197, 94, 0.6);
            transform: scale(1.02);
            transition: all 0.2s ease;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        .bounce-in {
            animation: bounceIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        .toast {
            transition: all 0.3s ease;
            transform: translateY(-10px);
        }
        .item-enter {
            animation: itemEnter 0.3s ease-out;
        }
        .item-exit {
            animation: itemExit 0.3s ease-in forwards;
        }
        .autocomplete-item {
            transition: all 0.2s ease;
        }
        .autocomplete-item:hover, .autocomplete-item.selected {
            background: rgba(20, 184, 166, 0.2);
            border-left: 3px solid rgba(20, 184, 166, 0.8);
        }
        .star-favorited {
            color: #fbbf24 !important;
            fill: #fbbf24 !important;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3) translateY(20px); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes itemEnter {
            from { transform: translateY(-10px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes itemExit {
            to { transform: translateX(100px) scale(0.8); opacity: 0; }
        }
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { 
                display: block !important; 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 80mm;
                color: black !important;
                background: white !important;
                font-family: 'Consolas', 'Monaco', 'Lucida Console', 'Courier New', monospace !important;
                font-weight: 600 !important;
                -webkit-font-smoothing: none !important;
                -moz-osx-font-smoothing: unset !important;
                text-rendering: optimizeLegibility !important;
            }
            #printArea strong {
                font-weight: 700 !important;
            }
            @page {
                margin: 5mm;
                size: 80mm auto;
            }
            /* Garantir que texto seja bem escuro na impressão */
            #printArea * {
                color: #000000 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-950 via-black to-gray-900 min-h-screen text-white">
    <div class="container mx-auto p-4 sm:p-6 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-6 sm:mb-8 fade-in">
            <div class="flex items-center justify-center mb-4">
                <img src="SuperNegrelli.png" alt="Super Negrelli" class="h-16 sm:h-20 lg:h-24 w-auto">
            </div>
            <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-green-400 to-teal-500 bg-clip-text text-transparent mb-2">
                Sistema de Pedidos
            </h1>
            <p class="text-gray-300 text-sm sm:text-base">Gestão de Pedidos | Super Negrelli</p>
        </div>

        <!-- Main Form -->
        <div class="grid lg:grid-cols-2 gap-4 lg:gap-6">
            <!-- Dados do Cliente -->
            <div class="glass-effect rounded-xl p-4 sm:p-6 slide-in">
                <h2 class="text-xl font-semibold mb-4 text-green-400 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                    Dados do Cliente
                </h2>
                
                <!-- Toggle Tipo de Pedido -->
                <div class="mb-6 p-4 bg-gray-800 rounded-lg border border-gray-600">
                    <div class="flex items-center justify-between mb-3">
                        <label class="text-sm font-medium text-orange-400 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 12a5 5 0 01-5-5h10a5 5 0 01-5 5z"/>
                            </svg>
                            Tipo de Pedido
                        </label>
                        <div class="flex items-center gap-3">
                            <span id="labelEntrega" class="text-sm font-medium text-teal-400">Entrega</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="toggleTipoPedido" class="sr-only peer">
                                <div class="w-11 h-6 bg-teal-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"></div>
                            </label>
                            <span id="labelRetirada" class="text-sm font-medium text-gray-400">Retirada</span>
                        </div>
                    </div>
                    
                    <!-- Campos específicos para Retirada/Encomenda -->
                    <div id="camposRetirada" class="hidden mt-4 pt-4 border-t border-gray-600">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-orange-400">Data de Retirada</label>
                                <input type="date" id="dataRetirada" 
                                       class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-orange-500 input-glow">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-orange-400">Horário de Retirada</label>
                                <input type="time" id="horarioRetirada" 
                                       class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-orange-500 input-glow">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="block text-sm font-medium mb-2 text-orange-400">Observações da Encomenda</label>
                            <textarea id="observacoesRetirada" 
                                      placeholder="Observações específicas para a retirada/encomenda..."
                                      class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-orange-500 input-glow"
                                      rows="2"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <!-- Busca de Cliente -->
                    <div>
                        <label class="block text-sm font-medium mb-2 text-green-400">Buscar Cliente</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">Por Telefone</label>
                                <input type="tel" id="telefone" placeholder="(11) 99999-9999" 
                                       class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow">
                                <button id="buscarPorTelefone" class="mt-2 w-full px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4 loading-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                    <svg class="w-4 h-4 search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                    </svg>
                                    Buscar
                                </button>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">Por Nome</label>
                                <input type="text" id="buscarNome" placeholder="Digite o nome do cliente" 
                                       class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow">
                                <button id="buscarPorNome" class="mt-2 w-full px-3 py-2 bg-teal-600 hover:bg-teal-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4 loading-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                    <svg class="w-4 h-4 search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    Buscar
                                </button>
                            </div>
                        </div>
                        <!-- Botão de Clientes Recentes -->
                        <div class="mt-3 flex justify-center">
                            <button id="mostrarClientesRecentes" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Últimos Clientes
                            </button>
                        </div>
                    </div>
                    
                    <!-- Lista de Resultados da Busca -->
                    <div id="resultadosBusca" class="hidden">
                        <label class="block text-sm font-medium mb-2 text-teal-400">Clientes Encontrados</label>
                        <div id="listaClientes" class="max-h-40 overflow-y-auto space-y-2 bg-gray-800 rounded-lg p-3 border border-gray-600">
                            <!-- Clientes encontrados aparecerão aqui -->
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Nome</label>
                        <input type="text" id="nome" placeholder="Nome completo do cliente"
                               class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow">
                    </div>
                    
                    <div class="relative">
                        <label class="block text-sm font-medium mb-2">CEP <span class="text-xs text-gray-400">(autocomplete disponível)</span></label>
                        <input type="text" id="cep" placeholder="Digite CEP ou rua para buscar..."
                               class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow"
                               autocomplete="off">
                        <!-- Dropdown de autocomplete para CEP -->
                        <div id="autocompleteCepDropdown" class="absolute z-50 w-full mt-1 bg-gray-800 border border-gray-600 rounded-lg shadow-lg hidden max-h-64 overflow-y-auto">
                            <div id="autocompleteCepList" class="py-2">
                                <!-- Sugestões aparecerão aqui -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="sm:col-span-1 relative">
                            <label class="block text-sm font-medium mb-2">Rua <span class="text-xs text-gray-400">(autocomplete disponível)</span></label>
                            <div class="relative">
                                <input type="text" id="rua" placeholder="Digite rua, CEP ou bairro para buscar..."
                                       class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow"
                                       autocomplete="off">
                            </div>
                            <!-- Dropdown de autocomplete -->
                            <div id="autocompleteDropdown" class="absolute z-50 w-full mt-1 bg-gray-800 border border-gray-600 rounded-lg shadow-lg hidden max-h-64 overflow-y-auto">
                                <div id="autocompleteList" class="py-2">
                                    <!-- Sugestões aparecerão aqui -->
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Número</label>
                            <input type="text" id="numero" placeholder="123"
                                   class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Complemento</label>
                        <input type="text" id="complemento" placeholder="Apto, bloco, etc."
                               class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow">
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Bairro</label>
                            <input type="text" id="bairro" placeholder="Nome do bairro"
                                   class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Cidade</label>
                            <input type="text" id="cidade" placeholder="Nome da cidade"
                                   class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 input-glow">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lista de Itens -->
            <div class="glass-effect rounded-xl p-4 sm:p-6 slide-in">
                <h2 class="text-xl font-semibold mb-4 text-teal-400 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5L2 21m5-8v8a2 2 0 002 2h6a2 2 0 002-2v-8"/>
                    </svg>
                    Itens do Pedido
                </h2>
                
                <div class="space-y-3">
                    <!-- Mobile: Layout em coluna -->
                    <div class="block sm:hidden space-y-3">
                        <input type="number" id="quantidade" placeholder="Quantidade" min="0.1" step="0.1"
                               class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500">
                        <select id="unidade" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500">
                            <option value="un">Unidade</option>
                            <option value="bj">Bandeja</option>
                            <option value="kg">Quilograma</option>
                            <option value="g">Grama</option>
                            <option value="dz">Dúzia</option>
                            <option value="fd">Fardo</option>
                            <option value="cx">Caixa</option>
                            <option value="R$">Reais (R$)</option>
                        </select>
                        <input type="text" id="descricao" placeholder="Descrição do produto"
                               class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <!-- Desktop: Layout em linha -->
                    <div class="hidden sm:grid grid-cols-12 gap-2">
                        <input type="number" id="quantidade-desktop" placeholder="Qtd" min="0.1" step="0.1"
                               class="col-span-3 p-2 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 text-sm">
                        <select id="unidade-desktop" class="col-span-2 p-2 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 text-sm">
                            <option value="un">un</option>
                            <option value="bj">bj</option>
                            <option value="kg">kg</option>
                            <option value="g">g</option>
                            <option value="dz">dz</option>
                            <option value="fd">fd</option>
                            <option value="cx">cx</option>
                            <option value="R$">R$</option>
                        </select>
                        <input type="text" id="descricao-desktop" placeholder="Descrição do produto"
                               class="col-span-7 p-2 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 text-sm">
                    </div>
                    <button id="adicionarItem" class="w-full py-2 bg-teal-600 hover:bg-teal-700 rounded-lg transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Adicionar Item
                    </button>
                    
                    <!-- Importação de Lista do WhatsApp -->
                    <div class="mt-4 p-4 bg-gray-800 rounded-lg border border-gray-600">
                        <h4 class="text-sm font-medium mb-3 text-purple-400 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Importar Lista do WhatsApp
                        </h4>
                        <textarea id="listaWhatsApp" 
                                  placeholder="Cole aqui a lista do cliente do WhatsApp...&#10;&#10;Exemplos suportados:&#10;• 2kg de carne&#10;• 1 pacote de açúcar&#10;• R$ 15,00 de frango&#10;• 3 un leite&#10;• 500g presunto"
                                  class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm"
                                  rows="4"></textarea>
                        <button id="importarLista" class="mt-3 w-full py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                            </svg>
                            Importar Lista
                        </button>
                    </div>
                    
                    <!-- Itens Rápidos -->
                    <div class="mt-4">
                        <h4 class="text-sm font-medium mb-3 text-blue-400 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Itens Rápidos - Águas 20L
                        </h4>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                            <button class="item-rapido px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2" 
                                    data-item="Font Life 20L">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                Font Life 20L
                            </button>
                            <button class="item-rapido px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2" 
                                    data-item="Ouro Fino 20L">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                Ouro Fino 20L
                            </button>
                            <button class="item-rapido px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2" 
                                    data-item="Timbu 20L">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                Timbu 20L
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="font-medium mb-3">Lista de Compras:</h3>
                    <div id="listaItens" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Itens serão adicionados aqui -->
                    </div>
                    <!-- Removido campo de total pois valores foram removidos -->
                </div>
            </div>
        </div>

        <!-- Forma de Pagamento -->
        <div class="glass-effect rounded-xl p-4 sm:p-6 mt-4 sm:mt-6 fade-in">
            <h2 class="text-xl font-semibold mb-4 text-green-400 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                Forma de Pagamento
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                <button class="pagamento-btn p-3 bg-gray-900 hover:bg-gray-800 border border-gray-700 rounded-lg transition-all" data-tipo="cartao">
                    Cartão
                </button>
                <button class="pagamento-btn p-3 bg-gray-900 hover:bg-gray-800 border border-gray-700 rounded-lg transition-all" data-tipo="pix-qr">
                    Pix QR Code
                </button>
                <button class="pagamento-btn p-3 bg-gray-900 hover:bg-gray-800 border border-gray-700 rounded-lg transition-all" data-tipo="pix-cnpj">
                    Pix CNPJ
                </button>
                <button class="pagamento-btn p-3 bg-gray-900 hover:bg-gray-800 border border-gray-700 rounded-lg transition-all" data-tipo="prazo">
                    A Prazo
                </button>
                <button class="pagamento-btn p-3 bg-gray-900 hover:bg-gray-800 border border-gray-700 rounded-lg transition-all" data-tipo="dinheiro">
                    Dinheiro
                </button>
            </div>
            
            <div id="campoTroco" class="mt-4 hidden">
                <label class="block text-sm font-medium mb-2">Precisa de troco? Para quanto?</label>
                <input type="number" id="valorTroco" placeholder="Valor para troco" min="0" step="0.01"
                       class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-teal-500">
            </div>
            
            <div class="mt-4">
                <span class="text-sm text-gray-400">Selecionado: </span>
                <span id="pagamentoSelecionado" class="font-medium">Nenhum</span>
            </div>
            
            <!-- Campo de Observações -->
            <div class="mt-6">
                <label class="block text-sm font-medium mb-2 text-teal-400 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Observações do Pedido
                </label>
                <textarea id="observacoesPedido" placeholder="Observações especiais, instruções de entrega, preferências do cliente..." rows="3"
                          class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-2 focus:ring-teal-500 input-glow resize-none"></textarea>
            </div>
        </div>

        <!-- Ações -->
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 mt-6 bounce-in">
            <button id="copiarWhatsApp" class="flex-1 min-w-48 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:hover:scale-100 flex items-center justify-center gap-2" disabled>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                Copiar para WhatsApp
            </button>
            <button id="imprimirPedido" class="flex-1 min-w-48 py-3 bg-teal-600 hover:bg-teal-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:hover:scale-100 flex items-center justify-center gap-2" disabled>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                </svg>
                Imprimir Pedido
            </button>
            <button id="historicoPedidos" class="py-3 px-6 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Histórico
            </button>
            <button id="novoPedido" class="py-3 px-6 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                Novo Pedido
            </button>
            <button id="exportarCSV" class="py-3 px-6 bg-teal-600 hover:bg-teal-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Exportar CSV
            </button>
        </div>

        <!-- Status -->
        <div id="status" class="mt-4 p-3 rounded-lg hidden">
            <span id="statusMessage"></span>
        </div>
    </div>

    <!-- Área de Impressão (Oculta) -->
    <div id="printArea" class="hidden">
        <div style="font-family: 'Consolas', 'Monaco', 'Lucida Console', 'Courier New', monospace; width: 80mm; font-size: 18px; line-height: 1.3; color: black; font-weight: 600; letter-spacing: 0.02em;">
            <div style="text-align: center; margin-bottom: 10px;">
                <strong style="font-size: 22px; font-weight: 700;">SUPER NEGRELLI</strong><br>
                <span id="printPedidoCodigo" style="font-weight: 700; font-size: 19px;"></span><br>
                <span id="printData" style="font-size: 16px; font-weight: 600;"></span>
            </div>
            <div style="border-top: 2px dashed black; margin: 6px 0;"></div>
            <div id="printCliente" style="margin: 6px 0; font-size: 17px; font-weight: 600;"></div>
            <div style="border-top: 1px dashed black; margin: 6px 0;"></div>
            <div id="printItens" style="margin: 6px 0; font-size: 17px; font-weight: 600;"></div>
            <div style="border-top: 1px dashed black; margin: 6px 0;"></div>
            <div id="printPagamento" style="margin: 6px 0; font-size: 17px; font-weight: 600;"></div>
            <div id="printObservacoes" style="margin: 6px 0; font-size: 16px; font-weight: 600;"></div>
            <div style="text-align: center; margin-top: 10px;">
                <strong id="printTotal" style="font-size: 18px; font-weight: 700;"></strong>
            </div>
            <div style="text-align: center; margin-top: 12px; font-size: 14px; font-weight: 600;">
                Obrigado pela preferência!
            </div>
        </div>
    </div>

    <!-- Modal do Histórico de Pedidos -->
    <div id="modalHistorico" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass-effect rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                        <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Histórico de Pedidos
                    </h2>
                    <button id="fecharModalHistorico" class="p-2 hover:bg-gray-700 rounded-lg transition-colors">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div id="listaHistorico" class="space-y-3 overflow-y-auto max-h-[70vh]">
                    <!-- Histórico será carregado aqui -->
                </div>
                
                <div id="carregandoHistorico" class="text-center py-8 hidden">
                    <svg class="w-8 h-8 mx-auto mb-3 animate-spin text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <p class="text-gray-400">Carregando histórico...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do IndexedDB
        let db;
        const DB_NAME = 'SupermercadoDB';
        const DB_VERSION = 1;

        // Estado da aplicação
        let itensCompra = [];
        let formaPagamentoSelecionada = '';
        let modoRetirada = false;
        
        // Estado do autocomplete
        let autocompleteAtivo = false;
        let selectedIndex = -1;
        let enderecosFiltrados = [];
        let timeoutAutocomplete = null;
        
        // Estado do autocomplete CEP
        let autocompleteCepAtivo = false;
        let selectedCepIndex = -1;
        let cepsFiltrados = [];
        let timeoutAutocompleteCep = null;

        // Elementos DOM
        const elements = {
            telefone: document.getElementById('telefone'),
            nome: document.getElementById('nome'),
            cep: document.getElementById('cep'),
            rua: document.getElementById('rua'),
            numero: document.getElementById('numero'),
            complemento: document.getElementById('complemento'),
            bairro: document.getElementById('bairro'),
            cidade: document.getElementById('cidade'),
            // Função helper para pegar valores dos campos responsivos
            get quantidade() { 
                return document.getElementById('quantidade') || document.getElementById('quantidade-desktop');
            },
            get unidade() { 
                return document.getElementById('unidade') || document.getElementById('unidade-desktop');
            },
            get descricao() { 
                return document.getElementById('descricao') || document.getElementById('descricao-desktop');
            },
            listaItens: document.getElementById('listaItens'),
            pagamentoSelecionado: document.getElementById('pagamentoSelecionado'),
            campoTroco: document.getElementById('campoTroco'),
            valorTroco: document.getElementById('valorTroco'),
            status: document.getElementById('status'),
            statusMessage: document.getElementById('statusMessage')
        };

        // Helper para pegar elementos responsivos ativos
        function getActiveElements() {
            return {
                quantidade: document.getElementById('quantidade')?.offsetParent !== null ? 
                    document.getElementById('quantidade') : document.getElementById('quantidade-desktop'),
                unidade: document.getElementById('unidade')?.offsetParent !== null ? 
                    document.getElementById('unidade') : document.getElementById('unidade-desktop'),
                descricao: document.getElementById('descricao')?.offsetParent !== null ? 
                    document.getElementById('descricao') : document.getElementById('descricao-desktop')
            };
        }

        // Inicializar banco de dados
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    
                    // Store para clientes
                    if (!database.objectStoreNames.contains('clientes')) {
                        const clientesStore = database.createObjectStore('clientes', { keyPath: 'telefone' });
                        clientesStore.createIndex('nome', 'nome', { unique: false });
                    }
                    
                    // Store para pedidos
                    if (!database.objectStoreNames.contains('pedidos')) {
                        const pedidosStore = database.createObjectStore('pedidos', { keyPath: 'codigo' });
                        pedidosStore.createIndex('data', 'data', { unique: false });
                    }
                };
            });
        }

        // Utilitários
        function formatarTelefone(valor) {
            const numero = valor.replace(/\D/g, '');
            return numero.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        }

        function formatarCEP(valor) {
            const cep = valor.replace(/\D/g, '');
            return cep.replace(/(\d{5})(\d{3})/, '$1-$2');
        }

        function formatarMoeda(valor) {
            return parseFloat(valor || 0).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
        }

        function mostrarStatus(mensagem, tipo = 'info') {
            // Remover toasts anteriores
            const existingToasts = document.querySelectorAll('.toast-notification');
            existingToasts.forEach(toast => toast.remove());

            // Criar novo toast
            const toast = document.createElement('div');
            const bgColor = tipo === 'error' ? 'bg-red-500' : tipo === 'success' ? 'bg-green-500' : 'bg-blue-500';
            const icon = tipo === 'error' ? 
                `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>` :
                tipo === 'success' ?
                `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>` :
                `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`;

            toast.className = `toast-notification fixed top-4 right-4 ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 z-50 slide-in`;
            toast.innerHTML = `
                ${icon}
                <span>${mensagem}</span>
                <button onclick="this.parentElement.remove()" class="ml-2 hover:bg-white hover:bg-opacity-20 rounded p-1 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            `;
            
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function toggleLoading(button, isLoading) {
            const loadingIcon = button.querySelector('.loading-icon');
            const searchIcon = button.querySelector('.search-icon');
            
            if (isLoading) {
                if (loadingIcon) {
                    loadingIcon.classList.remove('hidden');
                    loadingIcon.classList.add('loading-spinner');
                }
                if (searchIcon) searchIcon.classList.add('hidden');
                button.disabled = true;
            } else {
                if (loadingIcon) {
                    loadingIcon.classList.add('hidden');
                    loadingIcon.classList.remove('loading-spinner');
                }
                if (searchIcon) searchIcon.classList.remove('hidden');
                button.disabled = false;
            }
        }

        // Gerar código único do pedido
        function gerarCodigoPedido() {
            const hoje = new Date();
            const data = hoje.toISOString().split('T')[0].replace(/-/g, '');
            const numero = String(Date.now()).slice(-4);
            return `PED${data}${numero}`;
        }

        // Salvar cliente no banco
        function salvarCliente(cliente) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['clientes'], 'readwrite');
                const store = transaction.objectStore('clientes');
                const request = store.put(cliente);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Buscar cliente no banco
        function buscarCliente(telefone) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['clientes'], 'readonly');
                const store = transaction.objectStore('clientes');
                const request = store.get(telefone);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Buscar clientes por nome (busca parcial)
        function buscarClientesPorNome(nomeBusca) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['clientes'], 'readonly');
                const store = transaction.objectStore('clientes');
                const index = store.index('nome');
                
                const clientes = [];
                const request = index.openCursor();
                
                request.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor) {
                        const cliente = cursor.value;
                        // Busca case-insensitive e parcial
                        if (cliente.nome && cliente.nome.toLowerCase().includes(nomeBusca.toLowerCase())) {
                            clientes.push(cliente);
                        }
                        cursor.continue();
                    } else {
                        resolve(clientes);
                    }
                };
                
                request.onerror = () => reject(request.error);
            });
        }

        // Buscar clientes por telefone parcial
        function buscarClientesPorTelefoneParcial(telefoneParcial) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['clientes'], 'readonly');
                const store = transaction.objectStore('clientes');
                
                const clientes = [];
                const request = store.openCursor();
                
                request.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor) {
                        const cliente = cursor.value;
                        // Remove formatação e faz busca nos últimos dígitos
                        const telefoneNumeros = cliente.telefone.replace(/\D/g, '');
                        const buscaNumeros = telefoneParcial.replace(/\D/g, '');
                        
                        if (telefoneNumeros.includes(buscaNumeros)) {
                            clientes.push(cliente);
                        }
                        cursor.continue();
                    } else {
                        resolve(clientes);
                    }
                };
                
                request.onerror = () => reject(request.error);
            });
        }

        // Salvar pedido no banco
        function salvarPedido(pedido) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['pedidos'], 'readwrite');
                const store = transaction.objectStore('pedidos');
                const request = store.put(pedido);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Buscar CEP via ViaCEP
        async function buscarCEP(cep) {
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep.replace(/\D/g, '')}/json/`);
                const data = await response.json();
                
                if (data.erro) {
                    throw new Error('CEP não encontrado');
                }
                
                return data;
            } catch (error) {
                throw error;
            }
        }

        // Buscar clientes recentes (últimos pedidos)
        function buscarClientesRecentes(limite = 10) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['pedidos'], 'readonly');
                const store = transaction.objectStore('pedidos');
                const index = store.index('data');
                
                const pedidos = [];
                const clientesUnicos = new Map();
                
                // Buscar pedidos em ordem decrescente de data
                const request = index.openCursor(null, 'prev');
                
                request.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor && clientesUnicos.size < limite) {
                        const pedido = cursor.value;
                        const telefone = pedido.cliente.telefone;
                        
                        // Adicionar apenas se não vimos este cliente ainda
                        if (!clientesUnicos.has(telefone)) {
                            clientesUnicos.set(telefone, {
                                ...pedido.cliente,
                                ultimoPedido: new Date(pedido.data).toLocaleDateString('pt-BR')
                            });
                        }
                        cursor.continue();
                    } else {
                        resolve(Array.from(clientesUnicos.values()));
                    }
                };
                
                request.onerror = () => reject(request.error);
            });
        }

        // Buscar pedidos por data
        function buscarPedidosPorData(data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['pedidos'], 'readonly');
                const store = transaction.objectStore('pedidos');
                const index = store.index('data');
                
                const pedidos = [];
                const request = index.openCursor();
                
                request.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor) {
                        const pedidoData = cursor.value.data.split('T')[0];
                        if (pedidoData === data) {
                            pedidos.push(cursor.value);
                        }
                        cursor.continue();
                    } else {
                        resolve(pedidos);
                    }
                };
                
                request.onerror = () => reject(request.error);
            });
        }

        // Buscar últimos pedidos (histórico)
        function buscarUltimosPedidos(limite = 10) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['pedidos'], 'readonly');
                const store = transaction.objectStore('pedidos');
                const index = store.index('data');
                
                const pedidos = [];
                const request = index.openCursor(null, 'prev'); // Ordem decrescente por data
                
                request.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor && pedidos.length < limite) {
                        pedidos.push(cursor.value);
                        cursor.continue();
                    } else {
                        resolve(pedidos);
                    }
                };
                
                request.onerror = () => reject(request.error);
            });
        }

        // ========== SISTEMA DINÂMICO DE BUSCA DE ENDEREÇOS VIA VIACEP ==========

        // Cache para armazenar resultados de busca
        const cacheEnderecos = new Map();
        
        // Timeout para debounce
        let timeoutBusca = null;

        // Função para buscar endereços via ViaCEP API
        async function buscarEnderecosViaCEP(termo, cidade = 'Curitiba', uf = 'PR') {
            if (!termo || termo.length < 3) {
                return [];
            }
            
            // Criar chave para cache
            const chaveCache = `${uf}-${cidade}-${termo}`.toLowerCase();
            
            // Verificar cache primeiro
            if (cacheEnderecos.has(chaveCache)) {
                return cacheEnderecos.get(chaveCache);
            }
            
            try {
                // Fazer requisição para ViaCEP
                const url = `https://viacep.com.br/ws/${uf}/${encodeURIComponent(cidade)}/${encodeURIComponent(termo)}/json/`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    return [];
                }
                
                const dados = await response.json();
                
                // ViaCEP retorna um array ou um objeto com erro
                let enderecos = [];
                if (Array.isArray(dados)) {
                    enderecos = dados.map(endereco => ({
                        rua: endereco.logradouro,
                        cep: endereco.cep,
                        bairro: endereco.bairro,
                        cidade: endereco.localidade,
                        uf: endereco.uf
                    }));
                } else if (dados && !dados.erro) {
                    enderecos = [{
                        rua: dados.logradouro,
                        cep: dados.cep,
                        bairro: dados.bairro,
                        cidade: dados.localidade,
                        uf: dados.uf
                    }];
                }
                
                // Armazenar no cache
                cacheEnderecos.set(chaveCache, enderecos);
                
                // Limitar cache para evitar consumo excessivo de memória
                if (cacheEnderecos.size > 100) {
                    const primeiraChave = cacheEnderecos.keys().next().value;
                    cacheEnderecos.delete(primeiraChave);
                }
                
                return enderecos;
                
            } catch (error) {
                console.error('Erro ao buscar endereços via ViaCEP:', error);
                return [];
            }
        }
        
        // Buscar endereços com debounce
        function buscarEnderecosLista(termoBusca = '') {
            return new Promise((resolve) => {
                // Limpar timeout anterior
                if (timeoutBusca) {
                    clearTimeout(timeoutBusca);
                }
                
                // Se termo muito pequeno, retornar vazio
                if (!termoBusca || termoBusca.length < 3) {
                    resolve([]);
                    return;
                }
                
                // Aplicar debounce de 400ms
                timeoutBusca = setTimeout(async () => {
                    try {
                        const enderecos = await buscarEnderecosViaCEP(termoBusca);
                        resolve(enderecos.slice(0, 15)); // Limitar a 15 resultados
                    } catch (error) {
                        console.error('Erro na busca de endereços:', error);
                        resolve([]);
                    }
                }, 400);
            });
        }

        // ========== FUNÇÕES DE AUTOCOMPLETE ==========

        // Mostrar loading no autocomplete
        function mostrarLoadingAutocomplete() {
            const dropdown = document.getElementById('autocompleteDropdown');
            const lista = document.getElementById('autocompleteList');
            
            lista.innerHTML = `
                <div class="px-4 py-3 text-center">
                    <div class="flex items-center justify-center gap-2">
                        <div class="w-4 h-4 border-2 border-teal-400 border-t-transparent rounded-full animate-spin"></div>
                        <span class="text-gray-400">Buscando endereços...</span>
                    </div>
                </div>
            `;
            
            dropdown.classList.remove('hidden');
            autocompleteAtivo = true;
        }
        
        // Mostrar dropdown de autocomplete
        function mostrarAutocomplete(enderecos) {
            const dropdown = document.getElementById('autocompleteDropdown');
            const lista = document.getElementById('autocompleteList');
            
            lista.innerHTML = '';
            enderecosFiltrados = enderecos;
            selectedIndex = -1;
            
            if (enderecos.length === 0) {
                // Mostrar mensagem de "nenhum resultado encontrado"
                lista.innerHTML = `
                    <div class="px-4 py-3 text-center">
                        <div class="flex items-center justify-center gap-2">
                            <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"/>
                            </svg>
                            <span class="text-gray-400">Nenhum endereço encontrado</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Digite pelo menos 3 caracteres</div>
                    </div>
                `;
                dropdown.classList.remove('hidden');
                autocompleteAtivo = true;
                return;
            }
            
            enderecos.forEach((endereco, index) => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item px-4 py-3 cursor-pointer border-l-3 border-transparent';
                
                item.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="font-medium text-white">${endereco.rua}</div>
                            <div class="text-sm text-gray-400">CEP: ${endereco.cep} - ${endereco.bairro}</div>
                            <div class="text-xs text-gray-500">${endereco.cidade}/${endereco.uf}</div>
                        </div>
                        <div class="flex items-center gap-2 ml-3">
                            <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </div>
                    </div>
                `;
                
                item.addEventListener('click', () => selecionarEndereco(endereco));
                lista.appendChild(item);
            });
            
            dropdown.classList.remove('hidden');
            autocompleteAtivo = true;
        }

        // Esconder dropdown de autocomplete
        function esconderAutocomplete() {
            const dropdown = document.getElementById('autocompleteDropdown');
            dropdown.classList.add('hidden');
            autocompleteAtivo = false;
            selectedIndex = -1;
        }

        // Selecionar endereço do autocomplete
        function selecionarEndereco(endereco) {
            elements.rua.value = endereco.rua;
            elements.bairro.value = endereco.bairro;
            elements.cidade.value = endereco.cidade || "Curitiba";
            elements.cep.value = endereco.cep;
            
            esconderAutocomplete();
            
            // Validar pedido
            verificarValidadePedido();
            
            mostrarStatus(`Endereço selecionado: ${endereco.rua} - ${endereco.cidade}/${endereco.uf}`, 'success');
            
            // Focar no campo número para o usuário digitar
            elements.numero.focus();
        }

        // Navegar no autocomplete com teclado
        function navegarAutocomplete(direcao) {
            if (!autocompleteAtivo || enderecosFiltrados.length === 0) return;
            
            const items = document.querySelectorAll('.autocomplete-item');
            
            // Remover seleção anterior
            if (selectedIndex >= 0 && items[selectedIndex]) {
                items[selectedIndex].classList.remove('selected');
            }
            
            // Calcular novo índice
            if (direcao === 'down') {
                selectedIndex = selectedIndex < enderecosFiltrados.length - 1 ? selectedIndex + 1 : 0;
            } else if (direcao === 'up') {
                selectedIndex = selectedIndex > 0 ? selectedIndex - 1 : enderecosFiltrados.length - 1;
            }
            
            // Aplicar nova seleção
            if (items[selectedIndex]) {
                items[selectedIndex].classList.add('selected');
                items[selectedIndex].scrollIntoView({ block: 'nearest' });
            }
        }

        // Confirmar seleção do autocomplete
        function confirmarSelecaoAutocomplete() {
            if (autocompleteAtivo && selectedIndex >= 0 && enderecosFiltrados[selectedIndex]) {
                selecionarEndereco(enderecosFiltrados[selectedIndex]);
                return true;
            }
            return false;
        }

        // Buscar e mostrar endereços para autocomplete
        async function buscarAutocompleteEnderecos(termo) {
            // Mostrar loading se termo >= 3 caracteres
            if (termo.length >= 3) {
                mostrarLoadingAutocomplete();
            }
            
            try {
                const enderecos = await buscarEnderecosLista(termo);
                mostrarAutocomplete(enderecos);
            } catch (error) {
                console.error('Erro ao buscar endereços:', error);
                mostrarAutocomplete([]);
            }
        }

        // ========== FUNÇÕES DE AUTOCOMPLETE PARA CEP ==========

        // Mostrar dropdown de autocomplete para CEP
        function mostrarAutocompleteCep(enderecos) {
            const dropdown = document.getElementById('autocompleteCepDropdown');
            const lista = document.getElementById('autocompleteCepList');
            
            lista.innerHTML = '';
            cepsFiltrados = enderecos;
            selectedCepIndex = -1;
            
            if (enderecos.length === 0) {
                esconderAutocompleteCep();
                return;
            }
            
            enderecos.forEach((endereco, index) => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item px-4 py-3 cursor-pointer border-l-3 border-transparent';
                
                item.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="font-medium text-white">${endereco.cep}</div>
                            <div class="text-sm text-gray-400">${endereco.rua} - ${endereco.bairro}</div>
                        </div>
                        <div class="flex items-center gap-2 ml-3">
                            <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h4a1 1 0 011 1v2h4a1 1 0 110 2h-1v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6H3a1 1 0 110-2h4z"/>
                            </svg>
                        </div>
                    </div>
                `;
                
                item.addEventListener('click', () => selecionarEnderecoPorCep(endereco));
                lista.appendChild(item);
            });
            
            dropdown.classList.remove('hidden');
            autocompleteCepAtivo = true;
        }

        // Esconder dropdown de autocomplete CEP
        function esconderAutocompleteCep() {
            const dropdown = document.getElementById('autocompleteCepDropdown');
            dropdown.classList.add('hidden');
            autocompleteCepAtivo = false;
            selectedCepIndex = -1;
        }

        // Selecionar endereço pelo CEP
        function selecionarEnderecoPorCep(endereco) {
            elements.cep.value = endereco.cep;
            elements.rua.value = endereco.rua;
            elements.bairro.value = endereco.bairro;
            elements.cidade.value = endereco.cidade || "Curitiba";
            
            esconderAutocompleteCep();
            
            // Validar pedido
            verificarValidadePedido();
            
            mostrarStatus(`Endereço selecionado: ${endereco.cep} - ${endereco.rua}`, 'success');
            
            // Focar no campo número para o usuário digitar
            elements.numero.focus();
        }

        // Navegar no autocomplete CEP com teclado
        function navegarAutocompleteCep(direcao) {
            if (!autocompleteCepAtivo || cepsFiltrados.length === 0) return;
            
            const items = document.querySelectorAll('#autocompleteCepList .autocomplete-item');
            
            // Remover seleção anterior
            if (selectedCepIndex >= 0 && items[selectedCepIndex]) {
                items[selectedCepIndex].classList.remove('selected');
            }
            
            // Calcular novo índice
            if (direcao === 'down') {
                selectedCepIndex = selectedCepIndex < cepsFiltrados.length - 1 ? selectedCepIndex + 1 : 0;
            } else if (direcao === 'up') {
                selectedCepIndex = selectedCepIndex > 0 ? selectedCepIndex - 1 : cepsFiltrados.length - 1;
            }
            
            // Aplicar nova seleção
            if (items[selectedCepIndex]) {
                items[selectedCepIndex].classList.add('selected');
                items[selectedCepIndex].scrollIntoView({ block: 'nearest' });
            }
        }

        // Confirmar seleção do autocomplete CEP
        function confirmarSelecaoAutocompleteCep() {
            if (autocompleteCepAtivo && selectedCepIndex >= 0 && cepsFiltrados[selectedCepIndex]) {
                selecionarEnderecoPorCep(cepsFiltrados[selectedCepIndex]);
                return true;
            }
            return false;
        }

        // Buscar e mostrar endereços por CEP
        async function buscarAutocompleteCep(termo) {
            try {
                const enderecos = await buscarEnderecosLista(termo);
                mostrarAutocompleteCep(enderecos);
            } catch (error) {
                console.error('Erro ao buscar endereços por CEP:', error);
                mostrarAutocompleteCep([]);
            }
        }

        // ========== FUNÇÕES DO HISTÓRICO DE PEDIDOS ==========

        // Mostrar modal do histórico
        function mostrarModalHistorico() {
            const modal = document.getElementById('modalHistorico');
            modal.classList.remove('hidden');
            carregarHistoricoPedidos();
        }

        // Esconder modal do histórico
        function esconderModalHistorico() {
            const modal = document.getElementById('modalHistorico');
            modal.classList.add('hidden');
        }

        // Carregar histórico de pedidos
        async function carregarHistoricoPedidos() {
            const listaHistorico = document.getElementById('listaHistorico');
            const carregando = document.getElementById('carregandoHistorico');
            
            listaHistorico.innerHTML = '';
            carregando.classList.remove('hidden');
            
            try {
                const pedidos = await buscarUltimosPedidos(10);
                
                if (pedidos.length === 0) {
                    listaHistorico.innerHTML = `
                        <div class="text-center py-8 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <p>Nenhum pedido encontrado</p>
                            <p class="text-sm mt-1">Os pedidos aparecerão aqui conforme forem criados</p>
                        </div>
                    `;
                } else {
                    pedidos.forEach((pedido, index) => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'glass-effect p-4 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer';
                        
                        const data = new Date(pedido.data).toLocaleString('pt-BR');
                        const itensCount = pedido.itens.length;
                        const primeirosItens = pedido.itens.slice(0, 3).map(item => 
                            `${item.quantidade}${item.unidade} ${item.descricao}`
                        ).join(', ');
                        const maisItens = itensCount > 3 ? ` e mais ${itensCount - 3} itens...` : '';
                        
                        itemDiv.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="font-bold text-purple-400">${pedido.codigo}</span>
                                        <span class="text-xs text-gray-400">${data}</span>
                                    </div>
                                    <div class="text-white font-medium mb-1">${pedido.cliente.nome}</div>
                                    <div class="text-sm text-gray-400 mb-2">${pedido.cliente.telefone}</div>
                                    <div class="text-sm text-gray-300">${primeirosItens}${maisItens}</div>
                                    <div class="text-xs text-blue-400 mt-1">${pedido.formaPagamento}</div>
                                </div>
                                <button onclick="recuperarPedido('${pedido.codigo}')" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                                    </svg>
                                    Recuperar
                                </button>
                            </div>
                        `;
                        
                        listaHistorico.appendChild(itemDiv);
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar histórico:', error);
                listaHistorico.innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        <p>Erro ao carregar histórico</p>
                        <p class="text-sm mt-1">Tente novamente</p>
                    </div>
                `;
            } finally {
                carregando.classList.add('hidden');
            }
        }

        // Recuperar pedido do histórico
        async function recuperarPedido(codigoPedido) {
            try {
                const transaction = db.transaction(['pedidos'], 'readonly');
                const store = transaction.objectStore('pedidos');
                const request = store.get(codigoPedido);
                
                request.onsuccess = () => {
                    const pedido = request.result;
                    if (pedido) {
                        // Preencher formulário com dados do pedido
                        elements.telefone.value = pedido.cliente.telefone || '';
                        elements.nome.value = pedido.cliente.nome || '';
                        elements.cep.value = pedido.cliente.cep || '';
                        elements.rua.value = pedido.cliente.rua || '';
                        elements.numero.value = pedido.cliente.numero || '';
                        elements.complemento.value = pedido.cliente.complemento || '';
                        elements.bairro.value = pedido.cliente.bairro || '';
                        elements.cidade.value = pedido.cliente.cidade || '';
                        
                        // Preencher itens
                        itensCompra = [...pedido.itens];
                        atualizarListaItens();
                        
                        // Preencher forma de pagamento
                        document.querySelectorAll('.pagamento-btn').forEach(btn => {
                            btn.classList.remove('bg-teal-600', 'border-teal-500');
                            btn.classList.add('bg-gray-900', 'border-gray-700');
                            
                            if (btn.dataset.tipo === pedido.formaPagamento) {
                                btn.classList.remove('bg-gray-900', 'border-gray-700');
                                btn.classList.add('bg-teal-600', 'border-teal-500');
                                formaPagamentoSelecionada = pedido.formaPagamento;
                                elements.pagamentoSelecionado.textContent = btn.textContent;
                            }
                        });
                        
                        // Preencher observações
                        if (pedido.observacoes) {
                            document.getElementById('observacoesPedido').value = pedido.observacoes;
                        }
                        
                        // Verificar validação e fechar modal
                        verificarValidadePedido();
                        esconderModalHistorico();
                        
                        mostrarStatus(`Pedido ${codigoPedido} recuperado com sucesso!`, 'success');
                    }
                };
                
                request.onerror = () => {
                    mostrarStatus('Erro ao recuperar pedido', 'error');
                };
            } catch (error) {
                console.error('Erro ao recuperar pedido:', error);
                mostrarStatus('Erro ao recuperar pedido', 'error');
            }
        }

        // Mostrar lista de clientes encontrados
        function mostrarListaClientes(clientes) {
            const listaClientes = document.getElementById('listaClientes');
            const resultadosBusca = document.getElementById('resultadosBusca');
            
            listaClientes.innerHTML = '';
            
            if (clientes.length === 0) {
                listaClientes.innerHTML = '<p class="text-gray-400 text-sm py-2">Nenhum cliente encontrado</p>';
                resultadosBusca.classList.remove('hidden');
                return;
            }
            
            clientes.forEach(cliente => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-900 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors border border-gray-600 hover:border-teal-500';
                
                const endereco = cliente.rua ? `${cliente.rua}, ${cliente.numero}` : 'Endereço incompleto';
                const ultimoPedido = cliente.ultimoPedido ? `<p class="text-xs text-blue-400">Último pedido: ${cliente.ultimoPedido}</p>` : '';
                
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium text-white">${cliente.nome}</p>
                            <p class="text-sm text-gray-400">${cliente.telefone}</p>
                            <p class="text-xs text-gray-500">${endereco}</p>
                            ${ultimoPedido}
                        </div>
                        <svg class="w-5 h-5 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                `;
                
                div.addEventListener('click', () => selecionarCliente(cliente));
                listaClientes.appendChild(div);
            });
            
            resultadosBusca.classList.remove('hidden');
        }

        // Selecionar cliente da lista
        function selecionarCliente(cliente) {
            // Preencher formulário com dados do cliente
            elements.telefone.value = cliente.telefone || '';
            elements.nome.value = cliente.nome || '';
            elements.cep.value = cliente.cep || '';
            elements.rua.value = cliente.rua || '';
            elements.numero.value = cliente.numero || '';
            elements.complemento.value = cliente.complemento || '';
            elements.bairro.value = cliente.bairro || '';
            elements.cidade.value = cliente.cidade || '';
            
            // Esconder lista de resultados
            document.getElementById('resultadosBusca').classList.add('hidden');
            
            // Limpar campos de busca
            document.getElementById('buscarNome').value = '';
            
            mostrarStatus(`Cliente ${cliente.nome} selecionado!`, 'success');
            verificarValidadePedido();
        }

        // Esconder lista de clientes
        function esconderListaClientes() {
            document.getElementById('resultadosBusca').classList.add('hidden');
        }

        function atualizarListaItens() {
            elements.listaItens.innerHTML = '';

            itensCompra.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-3 bg-gray-900 rounded-lg item-enter hover:bg-gray-800 transition-colors';
                div.innerHTML = `
                    <div class="flex-1">
                        <span class="font-medium">${item.quantidade} ${item.unidade} - ${item.descricao}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="editarItem(${index})" class="px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition-all duration-200 hover:scale-110 flex items-center gap-1" title="Editar item">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </button>
                        <button onclick="removerItem(${index})" class="px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-sm transition-all duration-200 hover:scale-110 flex items-center gap-1" title="Remover item">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `;
                elements.listaItens.appendChild(div);
            });

            // Adicionar mensagem se não houver itens
            if (itensCompra.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'text-center text-gray-400 py-8 fade-in';
                emptyDiv.innerHTML = `
                    <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5L2 21m5-8v8a2 2 0 002 2h6a2 2 0 002-2v-8"/>
                    </svg>
                    <p>Nenhum item adicionado ainda</p>
                    <p class="text-sm mt-1">Use o formulário acima para adicionar produtos</p>
                `;
                elements.listaItens.appendChild(emptyDiv);
            }
        }

        function removerItem(index) {
            itensCompra.splice(index, 1);
            atualizarListaItens();
            verificarValidadePedido();
        }

        function editarItem(index) {
            const item = itensCompra[index];
            const activeElements = getActiveElements();
            
            // Preencher formulário com dados do item
            activeElements.quantidade.value = item.quantidade;
            activeElements.unidade.value = item.unidade;
            activeElements.descricao.value = item.descricao;
            
            // Remover item da lista
            itensCompra.splice(index, 1);
            atualizarListaItens();
            verificarValidadePedido();
            
            // Focar no campo quantidade
            activeElements.quantidade.focus();
            
            mostrarStatus('Item carregado para edição', 'info');
        }

        function limparCamposItem() {
            const activeElements = getActiveElements();
            activeElements.quantidade.value = '';
            activeElements.descricao.value = '';
            activeElements.quantidade.focus();
        }

        function verificarValidadePedido() {
            const telefoneValido = elements.telefone.value.replace(/\D/g, '').length >= 10;
            const nomeValido = elements.nome.value.trim() !== '';
            
            // No modo retirada, endereço é opcional
            const enderecoValido = modoRetirada ? true : (elements.rua.value.trim() !== '' && elements.cidade.value.trim() !== '');
            
            const temItens = itensCompra.length > 0;
            const temPagamento = formaPagamentoSelecionada !== '';

            const pedidoValido = telefoneValido && nomeValido && enderecoValido && temItens && temPagamento;

            document.getElementById('copiarWhatsApp').disabled = !pedidoValido;
            document.getElementById('imprimirPedido').disabled = !pedidoValido;
        }

        // Event Listeners
        elements.telefone.addEventListener('input', (e) => {
            e.target.value = formatarTelefone(e.target.value);
        });

        // Input no campo CEP - formatação e autocomplete
        elements.cep.addEventListener('input', (e) => {
            // Formatar CEP
            e.target.value = formatarCEP(e.target.value);
            
            // Autocomplete
            const termo = e.target.value.trim();
            clearTimeout(timeoutAutocompleteCep);
            
            if (termo.length >= 2) {
                timeoutAutocompleteCep = setTimeout(() => {
                    buscarAutocompleteCep(termo);
                }, 300); // Debounce de 300ms
            } else {
                esconderAutocompleteCep();
            }
        });

        // Navegação por teclado no campo CEP
        elements.cep.addEventListener('keydown', (e) => {
            if (autocompleteCepAtivo) {
                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        navegarAutocompleteCep('down');
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        navegarAutocompleteCep('up');
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (confirmarSelecaoAutocompleteCep()) {
                            return;
                        }
                        break;
                    case 'Escape':
                        e.preventDefault();
                        esconderAutocompleteCep();
                        break;
                }
            }
        });

        // Focus no campo CEP - mostrar endereços disponíveis se vazio
        elements.cep.addEventListener('focus', () => {
            if (elements.cep.value.trim() === '') {
                buscarAutocompleteCep('');
            }
        });

        // Blur no campo CEP - esconder autocomplete após delay e fazer busca ViaCEP se necessário
        elements.cep.addEventListener('blur', async (e) => {
            setTimeout(() => {
                esconderAutocompleteCep();
            }, 200); // Delay para permitir clique nas sugestões
            
            // Manter funcionalidade original de busca ViaCEP
            const cep = e.target.value.replace(/\D/g, '');
            if (cep.length === 8) {
                // Verificar se já não foi preenchido pelo autocomplete
                if (!elements.rua.value.trim()) {
                    e.target.classList.add('animate-pulse');
                    try {
                        const endereco = await buscarCEP(cep);
                        elements.rua.value = endereco.logradouro || '';
                        elements.bairro.value = endereco.bairro || '';
                        elements.cidade.value = endereco.localidade || '';
                        mostrarStatus('CEP encontrado!', 'success');
                    } catch (error) {
                        mostrarStatus('CEP não encontrado', 'error');
                    } finally {
                        e.target.classList.remove('animate-pulse');
                    }
                }
            }
        });

        // ========== EVENT LISTENERS PARA AUTOCOMPLETE ==========

        // Input no campo rua - autocomplete
        elements.rua.addEventListener('input', (e) => {
            const termo = e.target.value.trim();
            
            clearTimeout(timeoutAutocomplete);
            
            if (termo.length >= 2) {
                timeoutAutocomplete = setTimeout(() => {
                    buscarAutocompleteEnderecos(termo);
                }, 300); // Debounce de 300ms
            } else {
                esconderAutocomplete();
            }
        });

        // Navegação por teclado no campo rua
        elements.rua.addEventListener('keydown', (e) => {
            if (autocompleteAtivo) {
                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        navegarAutocomplete('down');
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        navegarAutocomplete('up');
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (confirmarSelecaoAutocomplete()) {
                            return;
                        }
                        break;
                    case 'Escape':
                        e.preventDefault();
                        esconderAutocomplete();
                        break;
                }
            }
        });

        // Focus no campo rua - mostrar endereços disponíveis se vazio
        elements.rua.addEventListener('focus', () => {
            if (elements.rua.value.trim() === '') {
                buscarAutocompleteEnderecos('');
            }
        });

        // Blur no campo rua - esconder autocomplete após delay
        elements.rua.addEventListener('blur', () => {
            setTimeout(() => {
                esconderAutocomplete();
            }, 200); // Delay para permitir clique nas sugestões
        });

        // Click fora do autocomplete - esconder
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('autocompleteDropdown');
            const dropdownCep = document.getElementById('autocompleteCepDropdown');
            const campoRua = elements.rua;
            const campoCep = elements.cep;
            
            if (!dropdown.contains(e.target) && e.target !== campoRua) {
                esconderAutocomplete();
            }
            
            if (!dropdownCep.contains(e.target) && e.target !== campoCep) {
                esconderAutocompleteCep();
            }
        });

        // ========== EVENT LISTENERS PARA HISTÓRICO ==========

        // Botão histórico
        document.getElementById('historicoPedidos').addEventListener('click', mostrarModalHistorico);

        // Fechar modal do histórico
        document.getElementById('fecharModalHistorico').addEventListener('click', esconderModalHistorico);

        // Click fora do modal para fechar
        document.getElementById('modalHistorico').addEventListener('click', (e) => {
            if (e.target.id === 'modalHistorico') {
                esconderModalHistorico();
            }
        });

        // Esc para fechar modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !document.getElementById('modalHistorico').classList.contains('hidden')) {
                esconderModalHistorico();
            }
        });

        document.getElementById('buscarPorTelefone').addEventListener('click', async () => {
            const telefone = elements.telefone.value.replace(/\D/g, '');
            const button = document.getElementById('buscarPorTelefone');
            
            if (telefone.length >= 4) { // Permitir busca com menos dígitos
                toggleLoading(button, true);
                esconderListaClientes();
                try {
                    // Primeiro tenta busca exata
                    if (telefone.length >= 10) {
                        const cliente = await buscarCliente(elements.telefone.value);
                        if (cliente) {
                            selecionarCliente(cliente);
                            return;
                        }
                    }
                    
                    // Se não encontrou ou telefone é parcial, busca por similaridade
                    const clientes = await buscarClientesPorTelefoneParcial(elements.telefone.value);
                    if (clientes.length > 0) {
                        mostrarListaClientes(clientes);
                        mostrarStatus(`${clientes.length} cliente(s) encontrado(s)`, 'success');
                    } else {
                        mostrarStatus('Nenhum cliente encontrado', 'info');
                    }
                } catch (error) {
                    mostrarStatus('Erro ao buscar cliente', 'error');
                } finally {
                    toggleLoading(button, false);
                }
            } else {
                mostrarStatus('Digite pelo menos 4 dígitos do telefone', 'error');
            }
        });

        // Event listener para busca por nome
        document.getElementById('buscarPorNome').addEventListener('click', async () => {
            const nome = document.getElementById('buscarNome').value.trim();
            const button = document.getElementById('buscarPorNome');
            
            if (nome.length >= 2) {
                toggleLoading(button, true);
                esconderListaClientes();
                try {
                    const clientes = await buscarClientesPorNome(nome);
                    if (clientes.length > 0) {
                        mostrarListaClientes(clientes);
                        mostrarStatus(`${clientes.length} cliente(s) encontrado(s)`, 'success');
                    } else {
                        mostrarStatus('Nenhum cliente encontrado com esse nome', 'info');
                    }
                } catch (error) {
                    mostrarStatus('Erro ao buscar cliente', 'error');
                } finally {
                    toggleLoading(button, false);
                }
            } else {
                mostrarStatus('Digite pelo menos 2 letras do nome', 'error');
            }
        });

        // Busca por nome em tempo real (opcional)
        document.getElementById('buscarNome').addEventListener('input', async (e) => {
            const nome = e.target.value.trim();
            if (nome.length >= 3) {
                try {
                    const clientes = await buscarClientesPorNome(nome);
                    if (clientes.length > 0 && clientes.length <= 5) { // Limitar sugestões
                        mostrarListaClientes(clientes);
                    }
                } catch (error) {
                    console.error('Erro na busca automática:', error);
                }
            } else {
                esconderListaClientes();
            }
        });

        // Event listener para mostrar clientes recentes
        document.getElementById('mostrarClientesRecentes').addEventListener('click', async () => {
            const button = document.getElementById('mostrarClientesRecentes');
            toggleLoading(button, true);
            esconderListaClientes();
            
            try {
                const clientesRecentes = await buscarClientesRecentes(8);
                if (clientesRecentes.length > 0) {
                    mostrarListaClientes(clientesRecentes);
                    mostrarStatus(`${clientesRecentes.length} clientes recentes encontrados`, 'success');
                } else {
                    mostrarStatus('Nenhum cliente encontrado no histórico', 'info');
                }
            } catch (error) {
                mostrarStatus('Erro ao buscar clientes recentes', 'error');
            } finally {
                toggleLoading(button, false);
            }
        });

        document.getElementById('adicionarItem').addEventListener('click', () => {
            const activeElements = getActiveElements();
            const quantidade = parseFloat(activeElements.quantidade.value);
            const unidade = activeElements.unidade.value;
            const descricao = activeElements.descricao.value.trim();

            if (!quantidade || !descricao) {
                mostrarStatus('Preencha quantidade e descrição', 'error');
                return;
            }

            const item = {
                id: Date.now(),
                quantidade,
                unidade,
                descricao
            };

            itensCompra.push(item);
            atualizarListaItens();
            limparCamposItem();
            verificarValidadePedido();
        });

        // Itens rápidos - águas 20L
        document.querySelectorAll('.item-rapido').forEach(button => {
            button.addEventListener('click', () => {
                const nomeItem = button.dataset.item;
                
                const item = {
                    id: Date.now(),
                    quantidade: 1,
                    unidade: 'un',
                    descricao: nomeItem
                };

                itensCompra.push(item);
                atualizarListaItens();
                verificarValidadePedido();
                mostrarStatus(`${nomeItem} adicionado!`, 'success');
            });
        });

        // Forma de pagamento
        document.querySelectorAll('.pagamento-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.pagamento-btn').forEach(b => {
                    b.classList.remove('bg-teal-600', 'border-teal-500');
                    b.classList.add('bg-gray-900', 'border-gray-700');
                });
                
                btn.classList.remove('bg-gray-900', 'border-gray-700');
                btn.classList.add('bg-teal-600', 'border-teal-500');
                
                formaPagamentoSelecionada = btn.dataset.tipo;
                elements.pagamentoSelecionado.textContent = btn.textContent;
                
                if (formaPagamentoSelecionada === 'dinheiro') {
                    elements.campoTroco.classList.remove('hidden');
                } else {
                    elements.campoTroco.classList.add('hidden');
                    elements.valorTroco.value = '';
                }
                
                verificarValidadePedido();
            });
        });

        // Copiar para WhatsApp
        document.getElementById('copiarWhatsApp').addEventListener('click', () => {
            const cliente = {
                telefone: elements.telefone.value,
                nome: elements.nome.value,
                endereco: `${elements.rua.value}, ${elements.numero.value}${elements.complemento.value ? ', ' + elements.complemento.value : ''}, ${elements.bairro.value}, ${elements.cidade.value}`
            };

            let texto = `🛒 *PEDIDO - ${gerarCodigoPedido()}*\n\n`;
            texto += `👤 *Cliente:* ${cliente.nome}\n`;
            texto += `📞 *Telefone:* ${cliente.telefone}\n`;
            
            if (modoRetirada) {
                const dataRetirada = document.getElementById('dataRetirada').value;
                const horarioRetirada = document.getElementById('horarioRetirada').value;
                const observacoesRetirada = document.getElementById('observacoesRetirada').value.trim();
                
                texto += `🏪 *RETIRADA/ENCOMENDA*\n`;
                if (dataRetirada) {
                    const dataFormatada = new Date(dataRetirada + 'T00:00:00').toLocaleDateString('pt-BR');
                    texto += `📅 *Data:* ${dataFormatada}\n`;
                }
                if (horarioRetirada) {
                    texto += `⏰ *Horário:* ${horarioRetirada}\n`;
                }
                if (observacoesRetirada) {
                    texto += `📝 *Obs. Retirada:* ${observacoesRetirada}\n`;
                }
            } else {
                texto += `📍 *Endereço:* ${cliente.endereco}\n`;
            }
            
            texto += `\n🛍️ *Itens:*\n`;
            
            itensCompra.forEach(item => {
                texto += `• ${item.quantidade} ${item.unidade} - ${item.descricao}\n`;
            });
            
            texto += `💳 *Pagamento:* ${document.querySelector('.pagamento-btn.bg-teal-600').textContent}`;
            
            if (formaPagamentoSelecionada === 'dinheiro' && elements.valorTroco.value) {
                texto += ` - Troco para ${formatarMoeda(elements.valorTroco.value)}`;
            }
            
            // Adicionar observações se houver
            const observacoes = document.getElementById('observacoesPedido').value.trim();
            if (observacoes) {
                texto += `\n\n📝 *Observações:*\n${observacoes}`;
            }

            navigator.clipboard.writeText(texto).then(() => {
                mostrarStatus('Pedido copiado para área de transferência!', 'success');
            });
        });

        // Imprimir pedido
        document.getElementById('imprimirPedido').addEventListener('click', async () => {
            const codigo = gerarCodigoPedido();
            const agora = new Date();
            
            // Salvar cliente
            const cliente = {
                telefone: elements.telefone.value,
                nome: elements.nome.value,
                cep: elements.cep.value,
                rua: elements.rua.value,
                numero: elements.numero.value,
                complemento: elements.complemento.value,
                bairro: elements.bairro.value,
                cidade: elements.cidade.value
            };
            
            try {
                await salvarCliente(cliente);
            } catch (error) {
                console.error('Erro ao salvar cliente:', error);
            }

            // Preparar dados para impressão
            document.getElementById('printPedidoCodigo').textContent = codigo;
            document.getElementById('printData').textContent = agora.toLocaleString('pt-BR');
            
            // Dados do cliente variam conforme o tipo de pedido
            if (modoRetirada) {
                const dataRetirada = document.getElementById('dataRetirada').value;
                const horarioRetirada = document.getElementById('horarioRetirada').value;
                const dataFormatada = dataRetirada ? new Date(dataRetirada + 'T00:00:00').toLocaleDateString('pt-BR') : '';
                
                document.getElementById('printCliente').innerHTML = `
                    <strong>RETIRADA/ENCOMENDA:</strong><br>
                    ${cliente.nome}<br>
                    ${cliente.telefone}<br>
                    ${dataRetirada && horarioRetirada ? `<strong>Para:</strong> ${dataFormatada} às ${horarioRetirada}` : ''}
                    ${dataRetirada && !horarioRetirada ? `<strong>Para:</strong> ${dataFormatada}` : ''}
                    ${!dataRetirada && horarioRetirada ? `<strong>Horário:</strong> ${horarioRetirada}` : ''}
                `;
            } else {
                document.getElementById('printCliente').innerHTML = `
                    <strong>CLIENTE:</strong><br>
                    ${cliente.nome}<br>
                    ${cliente.telefone}<br>
                    ${elements.rua.value}, ${elements.numero.value}<br>
                    ${elements.complemento.value ? elements.complemento.value + '<br>' : ''}
                    ${elements.bairro.value}, ${elements.cidade.value}
                `;
            }
            
            let itensHTML = '<strong>ITENS:</strong><br>';
            itensCompra.forEach(item => {
                itensHTML += `${item.quantidade} ${item.unidade} - ${item.descricao}<br>`;
            });
            document.getElementById('printItens').innerHTML = itensHTML;
            
            let pagamentoText = document.querySelector('.pagamento-btn.bg-teal-600').textContent;
            if (formaPagamentoSelecionada === 'dinheiro' && elements.valorTroco.value) {
                pagamentoText += ` - Troco: ${formatarMoeda(elements.valorTroco.value)}`;
            }
            document.getElementById('printPagamento').innerHTML = `<strong>PAGAMENTO:</strong><br>${pagamentoText}`;
            
            // Adicionar observações se houver
            const observacoes = document.getElementById('observacoesPedido').value.trim();
            if (observacoes) {
                document.getElementById('printObservacoes').innerHTML = `<div style="border-top: 1px dashed black; margin: 5px 0;"></div><strong>OBSERVAÇÕES:</strong><br>${observacoes.replace(/\n/g, '<br>')}`;
            } else {
                document.getElementById('printObservacoes').innerHTML = '';
            }
            
            // Removido total pois valores foram removidos
            document.getElementById('printTotal').textContent = '';

            // Salvar pedido
            const pedido = {
                codigo,
                data: agora.toISOString(),
                cliente,
                itens: [...itensCompra],
                formaPagamento: formaPagamentoSelecionada,
                valorTroco: elements.valorTroco.value || null,
                observacoes: document.getElementById('observacoesPedido').value.trim() || null
            };

            try {
                await salvarPedido(pedido);
                mostrarStatus('Pedido salvo com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao salvar pedido:', error);
            }

            // Imprimir
            window.print();
        });

        // Novo pedido
        document.getElementById('novoPedido').addEventListener('click', () => {
            if (confirm('Deseja iniciar um novo pedido? Os dados atuais serão perdidos.')) {
                // Limpar formulário
                Object.values(elements).forEach(el => {
                    if (el && el.value !== undefined) el.value = '';
                });
                
                // Limpar campos específicos
                document.getElementById('observacoesPedido').value = '';
                document.getElementById('buscarNome').value = '';
                
                // Esconder lista de clientes
                esconderListaClientes();
                
                // Resetar estado
                itensCompra = [];
                formaPagamentoSelecionada = '';
                
                // Resetar interface
                atualizarListaItens();
                elements.pagamentoSelecionado.textContent = 'Nenhum';
                elements.campoTroco.classList.add('hidden');
                
                // Resetar botões de pagamento
                document.querySelectorAll('.pagamento-btn').forEach(btn => {
                    btn.classList.remove('bg-teal-600', 'border-teal-500');
                    btn.classList.add('bg-gray-900', 'border-gray-700');
                });
                
                verificarValidadePedido();
                elements.telefone.focus();
                mostrarStatus('Novo pedido iniciado!', 'success');
            }
        });

        // Exportar CSV
        document.getElementById('exportarCSV').addEventListener('click', async () => {
            const hoje = new Date().toISOString().split('T')[0];
            
            try {
                const pedidosHoje = await buscarPedidosPorData(hoje);
                
                if (pedidosHoje.length === 0) {
                    mostrarStatus('Nenhum pedido encontrado para hoje', 'info');
                    return;
                }

                let csvContent = 'Codigo,Data,Cliente,Telefone,Endereco,Itens,Pagamento,Observacoes\n';
                
                pedidosHoje.forEach(pedido => {
                    const endereco = `${pedido.cliente.rua} ${pedido.cliente.numero} ${pedido.cliente.complemento} ${pedido.cliente.bairro} ${pedido.cliente.cidade}`.replace(/\s+/g, ' ').trim();
                    const itensDesc = pedido.itens.map(item => `${item.quantidade}${item.unidade} ${item.descricao}`).join('; ');
                    
                    const observacoes = pedido.observacoes ? pedido.observacoes.replace(/"/g, '""') : '';
                    csvContent += `"${pedido.codigo}","${new Date(pedido.data).toLocaleString('pt-BR')}","${pedido.cliente.nome}","${pedido.cliente.telefone}","${endereco}","${itensDesc}","${pedido.formaPagamento}","${observacoes}"\n`;
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `pedidos_${hoje}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                mostrarStatus(`${pedidosHoje.length} pedidos exportados!`, 'success');
            } catch (error) {
                mostrarStatus('Erro ao exportar CSV', 'error');
                console.error('Erro:', error);
            }
        });

        // Adicionar listeners para validação em tempo real
        ['telefone', 'nome', 'rua', 'cidade'].forEach(campo => {
            elements[campo].addEventListener('input', verificarValidadePedido);
        });

        // Permitir Enter para busca e adicionar itens
        function addEnterListeners() {
            const campos = [
                document.getElementById('quantidade'),
                document.getElementById('quantidade-desktop'),
                document.getElementById('descricao'),
                document.getElementById('descricao-desktop')
            ].filter(Boolean);
            
            campos.forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        document.getElementById('adicionarItem').click();
                    }
                });
            });

            // Enter nos campos de busca
            document.getElementById('telefone').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('buscarPorTelefone').click();
                }
            });

            document.getElementById('buscarNome').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('buscarPorNome').click();
                }
            });
        }
        
        addEnterListeners();

        // Removido auto-foco da quantidade para permitir digitação de múltiplos dígitos

        // Removido auto-foco do campo descrição pois campo valor foi removido

        // Permitir apenas números nos campos numéricos
        [elements.numero].forEach(input => {
            input.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/\D/g, '');
            });
        });

        // Inicializar aplicação
        async function iniciarApp() {
            try {
                await initDB();
                elements.telefone.focus();
                mostrarStatus('Sistema iniciado com sucesso!', 'success');
            } catch (error) {
                mostrarStatus('Erro ao inicializar sistema', 'error');
                console.error('Erro:', error);
            }
        }

        // Funções globais (chamadas pelo onclick e outras interações)
        window.removerItem = removerItem;
        window.editarItem = editarItem;
        window.selecionarCliente = selecionarCliente;
        window.recuperarPedido = recuperarPedido;

        // Toggle entre Entrega e Retirada
        document.getElementById('toggleTipoPedido').addEventListener('change', (e) => {
            modoRetirada = e.target.checked;
            const camposRetirada = document.getElementById('camposRetirada');
            const labelEntrega = document.getElementById('labelEntrega');
            const labelRetirada = document.getElementById('labelRetirada');
            
            if (modoRetirada) {
                camposRetirada.classList.remove('hidden');
                labelEntrega.classList.remove('text-teal-400');
                labelEntrega.classList.add('text-gray-400');
                labelRetirada.classList.remove('text-gray-400');
                labelRetirada.classList.add('text-orange-400');
            } else {
                camposRetirada.classList.add('hidden');
                labelEntrega.classList.remove('text-gray-400');
                labelEntrega.classList.add('text-teal-400');
                labelRetirada.classList.remove('text-orange-400');
                labelRetirada.classList.add('text-gray-400');
            }
            
            verificarValidadePedido();
        });

        // Importar lista do WhatsApp
        document.getElementById('importarLista').addEventListener('click', () => {
            const textarea = document.getElementById('listaWhatsApp');
            const lista = textarea.value.trim();
            
            if (!lista) {
                mostrarStatus('Cole uma lista do WhatsApp primeiro', 'error');
                return;
            }
            
            const itensImportados = parseWhatsAppList(lista);
            
            if (itensImportados.length === 0) {
                mostrarStatus('Nenhum item válido encontrado na lista', 'error');
                return;
            }
            
            // Adicionar todos os itens à lista
            itensImportados.forEach(item => {
                itensCompra.push(item);
            });
            
            atualizarListaItens();
            verificarValidadePedido();
            textarea.value = ''; // Limpar o campo
            
            mostrarStatus(`${itensImportados.length} item(ns) importado(s) com sucesso!`, 'success');
        });
        
        // Função para fazer parse da lista do WhatsApp
        function parseWhatsAppList(texto) {
            const linhas = texto.split('\n').filter(linha => linha.trim());
            const itens = [];
            
            linhas.forEach(linha => {
                const item = parseLinhaItem(linha.trim());
                if (item) {
                    itens.push(item);
                }
            });
            
            return itens;
        }
        
        // Função para fazer parse de uma linha individual
        function parseLinhaItem(linha) {
            // Remover marcadores como •, -, * do início
            linha = linha.replace(/^[\u2022\-\*\+]\s*/, '').trim();
            
            // Padrão 1: "R$ 15,00 de frango" ou "R$15 de carne"
            let match = linha.match(/^R\$\s*([\d,\.]+)\s+de\s+(.+)$/i);
            if (match) {
                const valor = parseFloat(match[1].replace(',', '.'));
                const descricao = match[2].trim();
                return {
                    quantidade: valor,
                    unidade: 'R$',
                    descricao: descricao
                };
            }
            
            // Padrão 2: "2kg de carne" ou "500g presunto"
            match = linha.match(/^([\d,\.]+)\s*(kg|g|un|dz|bj|fd|cx)\s*(?:de\s+)?(.+)$/i);
            if (match) {
                const quantidade = parseFloat(match[1].replace(',', '.'));
                const unidade = match[2].toLowerCase();
                const descricao = match[3].trim();
                return {
                    quantidade: quantidade,
                    unidade: unidade,
                    descricao: descricao
                };
            }
            
            // Padrão 3: "1 pacote de açúcar" ou "3 leite"
            match = linha.match(/^([\d,\.]+)\s+(.+)$/i);
            if (match) {
                const quantidade = parseFloat(match[1].replace(',', '.'));
                const descricao = match[2].trim();
                return {
                    quantidade: quantidade,
                    unidade: 'un',
                    descricao: descricao
                };
            }
            
            // Se não conseguiu fazer parse, retorna null
            return null;
        }

        // Inicializar quando a página carregar
        document.addEventListener('DOMContentLoaded', iniciarApp);
    </script>
</body>
</html>